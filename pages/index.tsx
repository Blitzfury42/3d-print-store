'use client'; import { useState } from 'react'; import { loadStripe } from '@stripe/js'; import { Elements, CardElement, useElements, useStripe } from '@stripe/react-stripe-js'; const stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!); export default function Home() { return (<Elements stripe={stripePromise}><OrderForm /></Elements>); } function OrderForm() { const stripe = useStripe(); const elements = useElements(); const [loading, setLoading] = useState(false); const [formData, setFormData] = useState({modelUrl: '', color: '', quantity: 1, specifications: '', customerEmail: '', customerName: '',}); const handleChange = (e: any) => { const { name, value } = e.target; setFormData((prev) => ({...prev, [name]: name === 'quantity' ? parseInt(value) : value,})); }; const handleSubmit = async (e: any) => { e.preventDefault(); setLoading(true); try { const response = await fetch('/api/orders/create', {method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({...formData, totalPrice: formData.quantity * 10,}),}); const { clientSecret, orderId } = await response.json(); const result = await stripe!.confirmCardPayment(clientSecret, {payment_method: {card: elements!.getElement(CardElement)!, billing_details: {name: formData.customerName, email: formData.customerEmail,},},}); if (result.paymentIntent?.status === 'succeeded') { alert(`Paiement réussi! Votre devis sera envoyé à ${formData.customerEmail}`); setFormData({modelUrl: '', color: '', quantity: 1, specifications: '', customerEmail: '', customerName: '',}); } } catch (error) { console.error('Error:', error); alert('Erreur lors du paiement'); } setLoading(false); }; return (<div className="min-h-screen bg-gray-100 py-12 px-4"><div className="max-w-md mx-auto bg-white rounded-lg shadow p-8"><h1 className="text-2xl font-bold mb-6">Commande d'Impression 3D</h1><form onSubmit={handleSubmit} className="space-y-4"><div><label className="block text-sm font-medium mb-1">Lien du modèle 3D</label><input type="url" name="modelUrl" value={formData.modelUrl} onChange={handleChange} required placeholder="https://example.com/model.stl" className="w-full px-3 py-2 border rounded" /></div><div><label className="block text-sm font-medium mb-1">Couleur</label><input type="text" name="color" value={formData.color} onChange={handleChange} required placeholder="Ex: Rouge, Bleu, Noir..." className="w-full px-3 py-2 border rounded" /></div><div><label className="block text-sm font-medium mb-1">Quantité</label><input type="number" name="quantity" value={formData.quantity} onChange={handleChange} required min="1" className="w-full px-3 py-2 border rounded" /></div><div><label className="block text-sm font-medium mb-1">Spécifications (Infill, paroi, etc.)</label><textarea name="specifications" value={formData.specifications} onChange={handleChange} placeholder="Ex: Infill 20%, Paroi 2mm..." rows={4} className="w-full px-3 py-2 border rounded" /></div><div><label className="block text-sm font-medium mb-1">Nom</label><input type="text" name="customerName" value={formData.customerName} onChange={handleChange} required className="w-full px-3 py-2 border rounded" /></div><div><label className="block text-sm font-medium mb-1">Email</label><input type="email" name="customerEmail" value={formData.customerEmail} onChange={handleChange} required className="w-full px-3 py-2 border rounded" /></div><div><label className="block text-sm font-medium mb-1">Carte Bancaire</label><CardElement className="border p-3 rounded" /></div><div className="text-xl font-bold">Prix total: {(formData.quantity * 10).toFixed(2)}€</div><button type="submit" disabled={!stripe || loading} className="w-full bg-blue-600 text-white py-2 rounded font-semibold disabled:opacity-50">{loading ? 'Traitement...' : 'Passer la commande'}</button></form></div></div>); }